---
--- 

<style>
    .inline {
        display: inline;
    }
</style>

<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>

    <div id="header"></div>

    <h1>Profile</h1>

    <p>Profile picture</p>

    <div id="username">
        <p style="display: inline;">Username: </p>
    </div>


    <h1>Account</h1>


    <form action="javascript:changePass()">
        <p><label>
            Password:
            <input type="password" name="password" id="password" required>
        </label></p>
        <p><button>Change password</button></p>
        <p id="message"></p>
    </form>

    <button onclick="cookieList()">cookie list</button>
</body>
</html>

<script>


    function changePass() {
        //document.getElementById("error").innerHTML = "";


        var baseurl = "https://taylorswifties.duckdns.org/api/users/update";
       
        const body = {
            username: "a",
            password: document.getElementById("password").value
        };

        // Set Headers to support cross origin
        //IMPORTANT!!!!!!! TO SUCCESSFULLY POST, YOU NEED TO REMOVE
        // credentials:'include'
        const requestOptions = {
            method: 'POST',
            mode: 'cors', // no-cors, *cors, same-origin
            cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
            //credentials: 'include', // include, *same-origin, omit
            body: JSON.stringify(body),
            headers: {
                "content-type": "application/json"
            },
        };

        // Fetch JWT
        fetch(baseurl, requestOptions)
        .then(response => {
            // trap error response from Web API
            if (!response.ok) {
                const errorMsg = response.status + " error";
                console.log(errorMsg);

                if (response.status === 400) {
                    console.log("Incorrect username or password");
                    
                    /*
                    let p = document.createElement("p");
                    let text = document.createTextNode("Incorrect username or password.");
                    p.appendChild(text);
                    document.getElementById("error").appendChild(p);
                    */
                }
            
                return;
            }

            response.json().then(data => {
                console.log(data);

            })

        })
    }  


    showUsername();

    function showUsername() {
        // retrieve cookie's value
        console.log(document.cookie);

        let cookie2 = document.cookie + ";";
        let correctCookie2 = cookie2.match(/(session=.*; |; session=.*;$|; session=.*; )/);
        correctCookie2 = correctCookie2[0].replace(/;/g, '');
        correctCookie2 = correctCookie2.replace('session=', '');
        correctCookie2 = correctCookie2.replace(/ /g, '');
        console.log(correctCookie2);

        // send fetch to backend's endpoint for user info
        var baseurl = "https://taylorswifties.duckdns.org/api/users/info";
        
        const body = {
            token: correctCookie2,
        };

        // Set Headers to support cross origin
        //IMPORTANT!!!!!!! TO SUCCESSFULLY POST, YOU NEED TO REMOVE
        // credentials:'include'
        const requestOptions = {
            method: 'POST',
            mode: 'cors', // no-cors, *cors, same-origin
            cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
            //credentials: 'include', // include, *same-origin, omit
            body: JSON.stringify(body),
            headers: {
                "content-type": "application/json"
            },
        };

        fetch(baseurl, requestOptions)
        .then(response => {
            if (!response.ok) {
                const errorMsg = 'Login error: ' + response.status;
                console.log(errorMsg);

                if (response.status == 400) {
                    console.log("Incorrect username or password");
                }
                return;
            }

            response.json().then(data => {
                console.log(data);
                
                // show username
                let p = document.createElement("p");
                p.setAttribute("class", "inline");
                let text = document.createTextNode(data["sub"]);
                p.appendChild(text);
                document.getElementById("username").appendChild(p);
                

            })

        })
    }
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script>$("#header").load("{{ site.baseurl }}/header.html");</script>